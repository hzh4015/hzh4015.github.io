<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Hadoop-MapReduce | Notes</title><meta name="keywords" content="Hadoop MapReduce 大数据 分布式"><meta name="author" content="秋水一色"><meta name="copyright" content="秋水一色"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="对学习Hadoop的一些知识笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="Hadoop-MapReduce">
<meta property="og:url" content="http://example.com/2022/05/26/Hadoop-MapReduce/index.html">
<meta property="og:site_name" content="Notes">
<meta property="og:description" content="对学习Hadoop的一些知识笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png">
<meta property="article:published_time" content="2022-05-25T16:00:00.000Z">
<meta property="article:modified_time" content="2022-05-26T14:22:54.930Z">
<meta property="article:author" content="秋水一色">
<meta property="article:tag" content="Hadoop">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/05/26/Hadoop-MapReduce/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Hadoop-MapReduce',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-26 22:22:54'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Notes" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/03/30/mD5ZV7wdUBGl62S.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Notes</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Hadoop-MapReduce</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-25T16:00:00.000Z" title="发表于 2022-05-26 00:00:00">2022-05-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-26T14:22:54.930Z" title="更新于 2022-05-26 22:22:54">2022-05-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Hadoop-MapReduce"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="一、MapReduce设计理念"><a href="#一、MapReduce设计理念" class="headerlink" title="一、MapReduce设计理念"></a>一、MapReduce设计理念</h3><blockquote>
<p>map—&gt;映射</p>
<p>reduce—&gt;归纳</p>
<p>mapreduce必须构建在hdfs之上的一种大数据离线计算框架</p>
<p>​        在线：实时数据处理</p>
<p>​        离线：数据处理时效性没有在线那么强，但是相对也需要很快得到结果</p>
<p>mapreduce不会马上得到结果，他会有一定的延时（磁盘IO）</p>
<p>​        如果数据量小，使用mapreduce反而不合适</p>
<p>​        杀鸡焉用宰牛刀</p>
<p>原始数据–&gt;map(Key,Value)–&gt;Reduce</p>
<p>分布式i计算</p>
<p>​        将大的数据切分成多个小数据，交给更多的节点参与运算</p>
<p>计算向数据靠拢</p>
<p>​        将计算传递给有数据的节点上进行工作</p>
</blockquote>
<h3 id="二、MapReduce架构特点"><a href="#二、MapReduce架构特点" class="headerlink" title="二、MapReduce架构特点"></a>二、MapReduce架构特点</h3><h4 id="MapReduce1-x"><a href="#MapReduce1-x" class="headerlink" title="MapReduce1.x"></a>MapReduce1.x</h4><blockquote>
<p><strong>JobTracker</strong></p>
<p>　　　主节点，单点，负责调度所有的作用和监控整个集群的资源负载。</p>
<p><strong>TaskTracker</strong></p>
<p>　　　从节点，自身节点资源管理和JobTracker进行心跳联系，汇报资源和获取task。</p>
<p><strong>Client</strong></p>
<p>　　　以作业为单位，规划作业计算分布，提交作业资源到HDFS，最终提交作业到JobTracker。</p>
<h5 id="MapReduce1-x的弊端"><a href="#MapReduce1-x的弊端" class="headerlink" title="MapReduce1.x的弊端"></a>MapReduce1.x的弊端</h5><p>　　1.JobTracker负载过重，存在单点故障。</p>
<p>　　2.资源管理和计算调度强耦合，其它计算框架难以复用其资源管理。</p>
<p>　　3.不同框架对资源不能全局管理。</p>
</blockquote>
<h4 id="MapReduce2-x"><a href="#MapReduce2-x" class="headerlink" title="MapReduce2.x"></a>MapReduce2.x</h4><blockquote>
<p>ResourceManager</p>
<p>　　　主节点，负责整个集群的资源管理。</p>
<p>NodeManager</p>
<p>　　　与ResourceManager汇报资源，管理Container生命周期，计算框架中的角色都以Container表示。</p>
<p>Container</p>
<p>　　　默认NodeManager启动线程监控Container大小，超出申请资源额度会kill掉。支持Linux内核的Cgroup。</p>
<p>Client</p>
<p>　　　ResourceManager-client：请求资源创建ApplicationMaster-client。</p>
<p>　　　ApplicationMaster-client：与ApplicationMaster交互。</p>
<p><strong>YARN【Yet Another Resource Negotiator】：Hadoop 2.0新引入的资源管理系统，直接从MRv1演化而来的。</strong></p>
<p><strong>核心思想：将MRv1中JobTracker的资源管理和任务调度两个功能分开，分别由ResourceManager和ApplicationMaster进程实现：</strong></p>
<p>　　　ResourceManager：负责整个集群的资源管理和调度。</p>
<p>　　　ApplicationMaster：负责应用程序相关的事务，比如任务调度、任务监控和容错等。</p>
<p>YARN的引入，使得多个计算框架可运行在一个集群中 每个应用程序对应一个ApplicationMaster 目前多个计算框架可以运行在YARN上，比如MapReduce、Spark、Storm等。</p>
</blockquote>
<h3 id="三、扑克牌的问题"><a href="#三、扑克牌的问题" class="headerlink" title="三、扑克牌的问题"></a>三、扑克牌的问题</h3><p><strong>你想数出一摞牌中有多少张黑桃，红桃，方块，梅花。直观方式是一张一张检查并且数出分别有多少张。</strong><br><strong>MapReduce方法则是：</strong><br>        1.给在座的所有玩家中分配这摞牌<br>        2.让每个玩家数自己手中的牌有几张是黑桃，然后把这个数目汇报给你<br>        3.你把所有玩家告诉你的数字加起来，得到最后的结论</p>
<h3 id="四、MR的计算流程"><a href="#四、MR的计算流程" class="headerlink" title="四、MR的计算流程"></a>四、MR的计算流程</h3><h4 id="4-1-原始数据File-可以从网上找一篇英文的文章"><a href="#4-1-原始数据File-可以从网上找一篇英文的文章" class="headerlink" title="4.1    原始数据File(可以从网上找一篇英文的文章)"></a>4.1    原始数据File(可以从网上找一篇英文的文章)</h4><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">The books chronicle the adventures of the adolescent wizard Harry Potter and his best friends Ron Weasley and Hermione Granger, all of whom are students at Hogwarts School of Witchcraft and Wizardry. </span><br></pre></td></tr></table></figure>

<blockquote>
<p>1T数据被切分成块存放在HDFS上，每一个块有128M大小</p>
</blockquote>
<h4 id="4-2-数据块Block"><a href="#4-2-数据块Block" class="headerlink" title="4.2    数据块Block"></a>4.2    数据块Block</h4><blockquote>
<p>block块是hdfs上存储的一个单元，同一个文件块的大小都是相同</p>
<p>因为数据存储到HDFS上不可变，所以有可能快的数量和集群的计算能力不匹配</p>
<p>我们需要一个动态调整本次参与计算节点数量的单位</p>
<p>我们可以动态的改变这个单位—&gt;参与的节点</p>
</blockquote>
<h4 id="5-3-切片Split"><a href="#5-3-切片Split" class="headerlink" title="5.3    切片Split"></a>5.3    切片Split</h4><blockquote>
<p>目的：动态地控制计算单元的数量 </p>
</blockquote>
<blockquote>
<p>切片是个逻辑概念</p>
<p>在不改变现有数据存储的情况下，可以控制参与计算的节点数目</p>
<p>通过切片大小可以达到控制计算节点数量的目的</p>
</blockquote>
<p><strong>有多少切片就会有多少个Map任务</strong></p>
<blockquote>
<p>一般切片大小为Block的整数倍（2    1&#x2F;2）</p>
<p>防止多余创建和很多的数据连接</p>
<p>如果Split大小 &gt; Block大小，计算节点少了  </p>
<p>如果Split大小 &lt; Block大小，计算节点多了</p>
<p>默认情况下，Split切片的大小等于Block的大小，默认128M，如果读取到最后一个block块的时候，与前一个block块组合起来大小小于128*1.1M的话，它们会结合生成一个Split切片，生成一个map任务</p>
<p>一个切片对应一个MapTask</p>
</blockquote>
<h4 id="4-4-MapTask"><a href="#4-4-MapTask" class="headerlink" title="4.4    MapTask"></a>4.4    MapTask</h4><blockquote>
<p>map默认从所属切片读取数据，每次读取一行（默认读取器）到内存中（map中的逻辑作用在每一行上）我们可以根据自己书写的分词逻辑（空格，逗号等分隔符），计算每个单词出现的次数 （wordcount），这时会产生（map &lt;String，Integer&gt;）临时数据，存放带内存中</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">the books chronicle the adventures of the adolescent wizard Harry Potter and his best friends Ron Weasley and Hermione Granger, all of whom are students at Hogwarts School of Witchcraft and Wizardry</span><br><span class="line"></span><br><span class="line">the 1</span><br><span class="line">books 1</span><br><span class="line">chronicle 1</span><br><span class="line">the 1</span><br><span class="line">adventures 1</span><br><span class="line">of 1</span><br><span class="line">...</span><br><span class="line">Wizardry 1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>但是内存的大小是有限的，如果每个任务随机的去占用内存，会导致内存不可控。多个任务同时执行有可能内存溢出（OOM）</p>
<p>如果把数据都直接放到硬盘上，效率低</p>
<p>考虑到把内存和硬盘结合，可以先往内存中写入一部分数据，然后写到硬盘上</p>
</blockquote>
<h4 id="4-5-环形缓冲区（KV-Buffer）"><a href="#4-5-环形缓冲区（KV-Buffer）" class="headerlink" title="4.5    环形缓冲区（KV-Buffer）"></a>4.5    环形缓冲区（KV-Buffer）</h4><blockquote>
<p>可以循环利用这块内存区域，减少数据溢写时map的停止时间</p>
<p>每一个Map可以独享的一个内存区域</p>
<p>在内存中构建一个环形缓冲区（kv-Buffer），默认大小为100M</p>
<p>设置缓冲区的阈值为80%（设置阈值的目的是为了同时写入和写出），当缓冲区的数据达到80M开始溢写到硬盘</p>
<p>溢写的时候有20M的空间可以被使用并且使用效率不会被减缓，不用担心出现OOM问题</p>
</blockquote>
<h4 id="4-6-分区Partition（环形缓冲区做的）"><a href="#4-6-分区Partition（环形缓冲区做的）" class="headerlink" title="4.6    分区Partition（环形缓冲区做的）"></a>4.6    分区Partition（环形缓冲区做的）</h4><blockquote>
<p>根据Key直接计算出对应的Reduce</p>
<p>分区的数量和reduce的数量是相等的</p>
<p>hash(key) % partition(reduce的数量) &#x3D; num</p>
<p>默认分区的算法是Hash然后取余</p>
<p>Object的hashCode()—equals()</p>
<p>如果两个对象equals，那么两个对象的hashcode一定相等</p>
<p>如果两个对象的hashcode相等，但是对象不一定equals</p>
</blockquote>
<h4 id="4-7-排序Sort（环形缓冲区做的，快速排序，对前面分区后的编号进行排序，目的是使得相同编号在一起）"><a href="#4-7-排序Sort（环形缓冲区做的，快速排序，对前面分区后的编号进行排序，目的是使得相同编号在一起）" class="headerlink" title="4.7    排序Sort（环形缓冲区做的，快速排序，对前面分区后的编号进行排序，目的是使得相同编号在一起）"></a>4.7    排序Sort（环形缓冲区做的，快速排序，对前面分区后的编号进行排序，目的是使得相同编号在一起）</h4><blockquote>
<p>对要溢写的数据进行排序（QuickSort）</p>
<p>按照先Partition后Key的顺序排序–&gt;相同分区在一起，相同Key的在一起</p>
<p>将来溢写出来的小文件也是有序的</p>
</blockquote>
<h4 id="4-8-溢写Spill"><a href="#4-8-溢写Spill" class="headerlink" title="4.8    溢写Spill"></a>4.8    溢写Spill</h4><blockquote>
<p>将内存中的数据循环写到硬盘上，无需担心OOM问题</p>
<p>每次会产生一个80M的文件</p>
<p>如果本次Map产生的数据较多，可能会溢写多个文件</p>
</blockquote>
<h4 id="4-9-合并Merge"><a href="#4-9-合并Merge" class="headerlink" title="4.9    合并Merge"></a>4.9    合并Merge</h4><blockquote>
<p>因为溢写会产生很多有序（分区 key）的小文件，而且小文件的数目也不确定</p>
<p>后面向reduce传递数据带来很大问题</p>
<p>所以将小文件合并成一个大文件，将来来取得数据直接从大文件拉去即可 </p>
<p>合并小文件的时候同样进行排序（<strong>归并排序</strong>），最终产生一个有序的大文件</p>
</blockquote>
<h4 id="4-10-组合器Combiner"><a href="#4-10-组合器Combiner" class="headerlink" title="4.10 组合器Combiner"></a>4.10 组合器Combiner</h4><blockquote>
<p>a.    集群的带宽限制了mapreduce作业的数量 ，因此应该尽量避免map和reduce任务之间的数据传输，hadoop允许用户对map的输出数据进行处理，用户可自定义combiner函数（如同map函数和reduce函数一般），其逻辑一般和reduce函数一样，combiner的输入是map的输出，combiner的输出作为reduce的输入，很多情况下可以直接将reduce函数作为combiner函数来试用</p>
<p>（job.setCombinerClass(FlowCountReducer.class)）</p>
<p>b.    combiner属于优化方案，所以无法确定combiner函数会调用多少次，可以在环形缓冲区溢出文件时调用combiner函数，也可以在溢出的小文件合并成大文件时调用combiner，但是要保证不管调用多少次，combiner函数都不影响最终结果，所以不是所有处理逻辑都可以使用combiner组件，有些逻辑如果使用了combiner函数会影响最后reduce的输出结果（如求几个数的平均值，就不能先用combiner求一次各个map输出结果的平均值，再求这些平均值的平均值，那样会导致结果错误）</p>
<p>c.  combiner的意义就是对每一个maptask的输出进行局部汇总，以减小网络传输量：</p>
<p>​        原先传给reduce的数据时a1 a1 a1 a1 a1</p>
<p>​        第一次combiner组合后变成a(1,1,1,1,1)</p>
<p>​        第二次combiner后传给reduce的数据变为a(5,5,6,7,23,…)</p>
</blockquote>
<h4 id="4-11-拉取Fetch"><a href="#4-11-拉取Fetch" class="headerlink" title="4.11    拉取Fetch"></a>4.11    拉取Fetch</h4><blockquote>
<p>我们需要将Map的临时结果拉取到Reduce节点</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;第一种方式：两两合并</span><br><span class="line">&gt;第二种方式：相同的进一个reduce</span><br><span class="line">&gt;第三种对第二种优化，排序</span><br><span class="line">&gt;第四种对第三种优化：如果一个reduce处理两种key，而key分布一个首一个尾，解决不连续的问题，给个编号，这个编号怎么算呢，`回到分区，排序`</span><br></pre></td></tr></table></figure>

<p>第一种方式：两两合并<br>第二种方式：相同的进一个reduce<br>第三种对第二种优化，排序<br>第四种对第三种优化：如果一个reduce处理两种key，而key分布一个首一个尾，解决不连续的问题，给个编号，这个编号怎么算呢，<code>回到分区，排序</code></p>
</blockquote>
<h4 id="4-12-合并Merge"><a href="#4-12-合并Merge" class="headerlink" title="4.12    合并Merge"></a>4.12    合并Merge</h4><blockquote>
<p>因为reduce拉取的时候，会从多个map拉取数据</p>
<p>那么每个map都会产生一个小文件,这些小文件（文件与文件之间无序，文件内部有序）</p>
<p>为了方便计算（没必要读取N个小文件）,需要合并文件</p>
<p>归并算法合并成2个(qishishilia)</p>
<p>相同的key都在一起</p>
</blockquote>
<h4 id="4-13-归并Reduce"><a href="#4-13-归并Reduce" class="headerlink" title="4.13    归并Reduce"></a>4.13    归并Reduce</h4><blockquote>
<p>将文件中的数据读取到内存中</p>
<p>一次性将相同的key全部读取到内存中</p>
<p>直接将相同的key得到结果-&gt;最终结果 </p>
</blockquote>
<h4 id="4-14-写出Output"><a href="#4-14-写出Output" class="headerlink" title="4.14    写出Output"></a>4.14    写出Output</h4><blockquote>
<p>每个reduce将自己计算的最终结果都会存放到HDFS上</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/05/26/QXb2lUNZsR7PB8g.png" alt="image-20220526222212188"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">秋水一色</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/05/26/Hadoop-MapReduce/">http://example.com/2022/05/26/Hadoop-MapReduce/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Notes</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Hadoop/">Hadoop</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/05/25/Hadoop%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%EF%BC%88HA%EF%BC%89/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hadoop高可用集群搭建（HA）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/05/23/Hadoop-2.7.6-%E5%9F%BA%E7%A1%80/" title="Hadoop-2.7.6-基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-23</div><div class="title">Hadoop-2.7.6-基础</div></div></a></div><div><a href="/2022/05/24/Hadoop%E8%BF%9B%E7%A8%8B%E7%9B%B8%E5%85%B3/" title="Hadoop进程相关"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-24</div><div class="title">Hadoop进程相关</div></div></a></div><div><a href="/2022/05/22/Hadoop%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%EF%BC%88%E5%AE%8C%E5%85%A8%E5%88%86%E5%B8%83%E5%BC%8F%EF%BC%89/" title="Hadoop集群搭建（完全分布式）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-22</div><div class="title">Hadoop集群搭建（完全分布式）</div></div></a></div><div><a href="/2022/05/25/Hadoop%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%EF%BC%88HA%EF%BC%89/" title="Hadoop高可用集群搭建（HA）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-25</div><div class="title">Hadoop高可用集群搭建（HA）</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/03/30/mD5ZV7wdUBGl62S.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">秋水一色</div><div class="author-info__description">春风得意马蹄疾,一日看尽长安花</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/hzh4015"><i class="fab fa-github"></i><span>一起学习，加油！</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/hzh4015" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:hzh4015@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=2597845702&amp;website=www.oicqzone.com" target="_blank" title="QQ"><i class="fab fa-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">这是我的第一个笔记</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81MapReduce%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">一、MapReduce设计理念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81MapReduce%E6%9E%B6%E6%9E%84%E7%89%B9%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">二、MapReduce架构特点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MapReduce1-x"><span class="toc-number">2.1.</span> <span class="toc-text">MapReduce1.x</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#MapReduce1-x%E7%9A%84%E5%BC%8A%E7%AB%AF"><span class="toc-number">2.1.1.</span> <span class="toc-text">MapReduce1.x的弊端</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MapReduce2-x"><span class="toc-number">2.2.</span> <span class="toc-text">MapReduce2.x</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%89%91%E5%85%8B%E7%89%8C%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">三、扑克牌的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81MR%E7%9A%84%E8%AE%A1%E7%AE%97%E6%B5%81%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">四、MR的计算流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AEFile-%E5%8F%AF%E4%BB%A5%E4%BB%8E%E7%BD%91%E4%B8%8A%E6%89%BE%E4%B8%80%E7%AF%87%E8%8B%B1%E6%96%87%E7%9A%84%E6%96%87%E7%AB%A0"><span class="toc-number">4.1.</span> <span class="toc-text">4.1    原始数据File(可以从网上找一篇英文的文章)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E6%95%B0%E6%8D%AE%E5%9D%97Block"><span class="toc-number">4.2.</span> <span class="toc-text">4.2    数据块Block</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E5%88%87%E7%89%87Split"><span class="toc-number">4.3.</span> <span class="toc-text">5.3    切片Split</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-MapTask"><span class="toc-number">4.4.</span> <span class="toc-text">4.4    MapTask</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%EF%BC%88KV-Buffer%EF%BC%89"><span class="toc-number">4.5.</span> <span class="toc-text">4.5    环形缓冲区（KV-Buffer）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-%E5%88%86%E5%8C%BAPartition%EF%BC%88%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%81%9A%E7%9A%84%EF%BC%89"><span class="toc-number">4.6.</span> <span class="toc-text">4.6    分区Partition（环形缓冲区做的）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7-%E6%8E%92%E5%BA%8FSort%EF%BC%88%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%81%9A%E7%9A%84%EF%BC%8C%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F%EF%BC%8C%E5%AF%B9%E5%89%8D%E9%9D%A2%E5%88%86%E5%8C%BA%E5%90%8E%E7%9A%84%E7%BC%96%E5%8F%B7%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F%EF%BC%8C%E7%9B%AE%E7%9A%84%E6%98%AF%E4%BD%BF%E5%BE%97%E7%9B%B8%E5%90%8C%E7%BC%96%E5%8F%B7%E5%9C%A8%E4%B8%80%E8%B5%B7%EF%BC%89"><span class="toc-number">4.7.</span> <span class="toc-text">4.7    排序Sort（环形缓冲区做的，快速排序，对前面分区后的编号进行排序，目的是使得相同编号在一起）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-%E6%BA%A2%E5%86%99Spill"><span class="toc-number">4.8.</span> <span class="toc-text">4.8    溢写Spill</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-9-%E5%90%88%E5%B9%B6Merge"><span class="toc-number">4.9.</span> <span class="toc-text">4.9    合并Merge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-10-%E7%BB%84%E5%90%88%E5%99%A8Combiner"><span class="toc-number">4.10.</span> <span class="toc-text">4.10 组合器Combiner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-11-%E6%8B%89%E5%8F%96Fetch"><span class="toc-number">4.11.</span> <span class="toc-text">4.11    拉取Fetch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-12-%E5%90%88%E5%B9%B6Merge"><span class="toc-number">4.12.</span> <span class="toc-text">4.12    合并Merge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-13-%E5%BD%92%E5%B9%B6Reduce"><span class="toc-number">4.13.</span> <span class="toc-text">4.13    归并Reduce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-14-%E5%86%99%E5%87%BAOutput"><span class="toc-number">4.14.</span> <span class="toc-text">4.14    写出Output</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/26/Hadoop-MapReduce/" title="Hadoop-MapReduce"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hadoop-MapReduce"/></a><div class="content"><a class="title" href="/2022/05/26/Hadoop-MapReduce/" title="Hadoop-MapReduce">Hadoop-MapReduce</a><time datetime="2022-05-25T16:00:00.000Z" title="发表于 2022-05-26 00:00:00">2022-05-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/25/Hadoop%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%EF%BC%88HA%EF%BC%89/" title="Hadoop高可用集群搭建（HA）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hadoop高可用集群搭建（HA）"/></a><div class="content"><a class="title" href="/2022/05/25/Hadoop%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%EF%BC%88HA%EF%BC%89/" title="Hadoop高可用集群搭建（HA）">Hadoop高可用集群搭建（HA）</a><time datetime="2022-05-24T16:00:00.000Z" title="发表于 2022-05-25 00:00:00">2022-05-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/24/Hadoop%E8%BF%9B%E7%A8%8B%E7%9B%B8%E5%85%B3/" title="Hadoop进程相关"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hadoop进程相关"/></a><div class="content"><a class="title" href="/2022/05/24/Hadoop%E8%BF%9B%E7%A8%8B%E7%9B%B8%E5%85%B3/" title="Hadoop进程相关">Hadoop进程相关</a><time datetime="2022-05-23T16:00:00.000Z" title="发表于 2022-05-24 00:00:00">2022-05-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/23/Hadoop-2.7.6-%E5%9F%BA%E7%A1%80/" title="Hadoop-2.7.6-基础"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hadoop-2.7.6-基础"/></a><div class="content"><a class="title" href="/2022/05/23/Hadoop-2.7.6-%E5%9F%BA%E7%A1%80/" title="Hadoop-2.7.6-基础">Hadoop-2.7.6-基础</a><time datetime="2022-05-22T16:00:00.000Z" title="发表于 2022-05-23 00:00:00">2022-05-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/22/Hadoop%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%EF%BC%88%E5%AE%8C%E5%85%A8%E5%88%86%E5%B8%83%E5%BC%8F%EF%BC%89/" title="Hadoop集群搭建（完全分布式）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hadoop集群搭建（完全分布式）"/></a><div class="content"><a class="title" href="/2022/05/22/Hadoop%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%EF%BC%88%E5%AE%8C%E5%85%A8%E5%88%86%E5%B8%83%E5%BC%8F%EF%BC%89/" title="Hadoop集群搭建（完全分布式）">Hadoop集群搭建（完全分布式）</a><time datetime="2022-05-21T16:00:00.000Z" title="发表于 2022-05-22 00:00:00">2022-05-22</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://raw.githubusercontent.com/hzh4015/myphotos/main/%E8%83%8C%E6%99%AF.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 秋水一色</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>